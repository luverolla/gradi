# SDD - Software Design Document

This document illustrates what is the ides behind the GRADI software
and how it has been implemented

## The idea

GRADI is the short for _**GR**ande **A**rchivio **DI**gitale_, 
that, in italian language, means literally _great digital archive_.

The idea was to give companies, schools, or other kind of communities,
a way to store, edit and consult digital resources, regardless of their kind.
They can be general resources, such as books, movies or songs; but also,
more specific resources, such as medical records, degree theses or products in a stock.

For that, the system has to store information about resource types
and change them dynamically, in order to adapt to all future needs.

On the user side, I thought that there may be users at different levels,
with read or write permissions only on certain resources, groups
of resources, or resource types.

There is also a special user: the administrator (admin). It has full permissions
of everything belonging to the system, and it's the only one able to create, edit
or delete information about users and resource types.

## Entities

The idea described above has been implemented relaying on the following data structures.
These are used for both Java entity classes and database entity tables.

For each entity, apart from their own properties, the system stores two timestamps:
`createdAt` and `updatedAt`, that tells respectively, when the object has been created
and the last time it has been updated. 

All timestamps are represented with their timezone, indicated as offset from UTC.

### User

This entity represent the user who access the GRADI software to administer, edit or
just consult resources. Its properties are:
* `code`: unique for each object
* `name`: first name(s)
* `surname`: last name
* `email`: email address
* `password`: access password
* `description`: some details (not really used)
* `role`: represent level of authorizations, can be:
  * `USER`: has permission to consult resources
  * `EDITOR`: has permission to consult resources and create its own
  * `ADMIN`: system's administrator, has full permissions on everything

Code is automatically generated by system, and once created cannot be updated.
Since password are stored with encryption, cannot be directly modified, instead,
a new one is sent on users' request.

### Resource

This entity represent a digital resource stored on GRADI system. Its properties are:

* `code`: unique for each object
* `name`: mnemonic name
* `type`: resource type, defined custom properties
* `description`: some information
* `parent`: resource logically designed as parent (such as "collection" for "book")
* `visibility`: combined with [ResourcePermission](#resourcepermission) objects, grants
   or deny access permission to certain users, can be:
  * `PUBLIC`: like `INTERNAL`, but also non-registered user can consult
  * `INTERNAL` all registered users can consult, all editors can edit
    individual resource permissions are ignored.
  * `RESTRICTED` access permissions are defined by [ResourcePermission](#resourcepermission)
    objects

Code is automatically generated by system, and once created cannot be updated.
Since type brings along custom properties' information, once set, cannot be updated.

### ResourcePermission

This entity represent a permission that a certain user has on a certain resource.
Is composed by the following properties:
* `index`: unique progressive index, used as database table ID
* `user`: the user who has permission
* `resource`: the resource on which the permission applies
* `type`: represent the permission's level, can be:
  * `READ`: read-only permission
  * `WRITE`: read and write permission
  * `FULL`: same as `WRITE` but assigned only to the author user to identify it

When a user issues a request to update resource's permission, all existing permissions
are deleted, and new permission are created. The `FULL` permission is always preserved.

### ResourceType

This entity represent a type of resource, at which a set of properties belongs.
Its properties are:
* `code`: unique code for each object
* `name`: mnemonic name
* `brief`: brief plain text description
* `description`: full description (intended for HTML text)

Code is automatically generated by system, and once created cannot be updated.
The brief description is intended to be used in dropdown menus (like HTML `select`) to show some details.

### ResourceProperty

This entity represents a custom property belonging to a [ResourceType](#resourcetype).
Its properties are:
* `name`: unique name for each object
* `resourceType`: resource type at which the property belongs
* `type`: data type, can be
  * `STRING`: one-line plain text string
  * `TEXT`: formatted text (like HTML)
  * `NUMERIC`: real numbers, relies on the Java type `Double`
  * `DATETIME`: timestamps with time zone, relies on the Java type `OffsetDateTime`
  * `FIXED`: short string values in a certain set, like values that come out from dropdown menus
  * `RESOURCE`: resource's URIs, for internal referencing

When a user requests to add a resource property, it provides a alphanumeric space-free name.
Then, the server prepends to this name, the resource type's code and a pound sign (`#`).
So, for example, if user provides the property `author` to the resource type with code `04A8C13F90`,
the generated property's name will be: `04A8C13F90#author`.

Since the resource type represents vital information for the resource property, 
once set, it cannot be modified.

### ResourceAttribute

This entity represents a custom attribute of a resource.
Its properties are:
* `name`: unique name for each object
* `resourceProperty`: related custom property
* `resource`: resource at which attribute belongs
* `value`: attribute's value, with correct data type (imposed by property)

When a user requests to add a resource attribute, it provides the related property's name.
Then, the server prepends to this name, the resource's code and a pound sign (`#`).
So, for example, if user wants to set the property `author` to the resource with code `01A778BF45`,
the generated attribute's name will be: `01A778BF45#author`.