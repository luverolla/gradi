# RAD - REST API Documentation

This document illustrates application's API endpoints, how to access them,
how to build requests, and how to process responses; in order to build client
applications with ease.

## API structure

This software API has been designed following the REST paradigm,
with JSON-formatted data for both request and response body, when present.

All endpoints URLs follow the `{domain}/api/{path}` wildcard, where `${domain}` is
the address, or hostname, at which the given GRADI installation can be reached;
and `{path}` is the chosen endpoint.

From this point, the document will refer to the first URL above just as `/api`.

There are three categories of endpoints:
* __Public endpoints__: reachable at `/api/public/{path}`, accessible by everyone
  inside, or outside, the platform and requires no authentication.
* __User endpoints__: reachable at `/api/user/{path}`, accessible by every
  registered user, requires authentication.
* __Admin endpoints__: reachable at `/api/admin/{path}`, accessible only by
  system's administrator, and, as obvious, requires authentication.

All requests can throw `404 Not Found`, if requested resource cannot be found,
or `403 Forbidden` if current user isn't authenticated or authorized.

Each endpoint is described as follows:
```
METHOD /path/to/endpoint

{} : RequestBodyType (or [] : RequestBodyType)

{} : ResponseBodyType (or [] : ResponseBodyType)
```

## Security

Each user authenticates itself sending a `POST` request to the `/api/public/auth` endpoint,
providing email and password.

In case of success a JWT token is provided, and must be set as header for all requests that
requires authentication. The header name is provided with the token, and can be set
in `application.properties` file. The default value is `Authorization`.

## Public endpoints

### auth

Authenticates user with given email and plain password. In case of success, an object
containing token information is sent as response body.

```
POST /api/public/auth

{
    email : string
    password : string
}

{
    header : string
    token : string
    expiration : int
}
```

## Admin endpoints

### getUsers

Retrieves all users matching the ()[EntitySetRequest]'s object given as request body.

```
GET /api/admin/users

{} : EntitySetRequest

[] : User[]
```

### getUser

Retrieve the user, whose code is passed as URL parameter. Request's body is ignored.

```
GET /api/users/{code}

<no request body>

{} : User
```

### addUsers

Adds new users to the database. Users' data is passed as request body except for the
`code` field, that is overwritten by software's procedure. Response body contains
the same user data, with codes and dates generated by server.

```
POST /api/admin/users

[] : User[]

[] : User[]
```

### updateUser

Update the user, whose code is passed as URL parameter, with new details passed
as request's body. However, only some details are updated. Refer to SSD.
Response's body contains updated user's data.

```
PUT /api/admin/users/{code}

{} : User

{} : User
```

### deleteUser

Deletes the user, whose code is passed as URL parameter. Request body is ignored.
In case of success, the server responds with `204 No Content` status,
since response's body is empty.

```
DELETE /api/admin/users/{code}

<no request body>

<no response body>
```

### getResources

Retrieves all resources matching the ()[EntitySetRequest]'s object given as request body.

```
GET /api/admin/resources

{} : EntitySetRequest

[] : Resources[]
```

### getResources

Retrieve the resource, whose code is passed as URL parameter. Request's body is ignored.

```
GET /api/resources/{code}

<no request body>

{} : Resource
```

### addResources

Adds new resources to the database. Resources' data is passed as request body except for the
`code` field, that is overwritten by software's procedure. Response body contains
the same data, with codes and dates generated by server.

Resources' attributes and permissions are added separately. But, the software, considering
that the admin is who makes the request, adds automatically the full permission
for the admin user.

```
POST /api/admin/resources

[] : Resource[]

[] : Resource[]
```

### updateResource

Update the resource, whose code is passed as URL parameter, with new details passed
as request's body. However, only some details are updated. Refer to SSD.
Response's body contains updated resource's data.

Attributes and permissions are updated separately.

```
PUT /api/admin/resources/{code}

{} : Resource

{} : Resource
```

### deleteResource

Deletes the resource, whose code is passed as URL parameter. Request body is ignored.
In case of success, the server responds with `204 No Content` status,
since response's body is empty.

```
DELETE /api/admin/resources/{code}

<no request body>

<no response body>
```