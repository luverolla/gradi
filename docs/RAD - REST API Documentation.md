# RAD - REST API Documentation

This document illustrates application's API endpoints, how to access them,
how to build requests, and how to process responses; in order to build client
applications with ease.

## API structure

This software API has been designed following the REST paradigm,
with JSON-formatted data for both request and response body, when present.

All endpoints URLs follow the `{domain}/api/{path}` wildcard, where `{domain}` is
the address, or hostname, at which the given GRADI installation can be reached;
and `{path}` is the chosen endpoint.

From this point, the document will refer to the first URL above just as `/api`.

There are three categories of endpoints:
* __Public endpoints__: reachable at `/api/public/{path}`, accessible by everyone
  inside, or outside, the platform and requires no authentication.
* __User endpoints__: reachable at `/api/user/{path}`, accessible by every
  registered user, requires authentication.
* __Admin endpoints__: reachable at `/api/admin/{path}`, accessible only by
  system's administrator, and, as obvious, requires authentication.

The following errors can be thrown:
* `404 Not Found` if resource doesn't exist or user is not authorized.
* `403 Forbidden` in come cases when user is not authenticated or authorized.
* `400 Bad Request` if request's header or body are malformed.

It may seem strange to throw `404 Not Found` instead of `403 Forbidden` or `401 Not Authorized`
in case of non-authorized users. But, it's a matter of security:
if a non-authorized user receives a forbidden alert, he will know that the requested
resource exists at that address.

Responses with status `500 Internal Server Error`, or `5XX` errors in general, 
may be related to filesystem permissions issues, an incorrect configuration,
or a software bug. In this last case, [fill an issue](https://github.com/luverolla/gradi/issues).

Each endpoint is described as follows:
```
METHOD /path/to/endpoint

{} : RequestBodyType (or [] : RequestBodyType)

{} : ResponseBodyType (or [] : ResponseBodyType)
```

## Security

Each user authenticates itself sending a `POST` request to the `/api/public/auth` endpoint,
providing email and password.

In case of success a JWT token is provided, and must be set as header for all requests that
requires authentication. The header name is provided with the token, and can be set
in `application.properties` file. The default value is `Authorization`.

## Public endpoints

### selfTest

This is used to check if installation has been completed successfully and system is on.
Response is a check message with current timestamp. Request's body is ignored.

```
POST /api/public/self-test

<no request body>

{
    message : string
    timestamp : string
}
```

### auth

Authenticates user with given email and plain password. In case of success, an object
containing token information is sent as response body.

```
POST /api/public/auth

{
    email : string
    password : string
}

{
    header : string
    token : string
    expiration : int
}
```

## Admin endpoints

### getUsers

Retrieves all users matching the ()[EntitySetRequest]'s object given as request body.

```
GET /api/admin/users

{} : EntitySetRequest

[] : User[]
```

### getUser

Retrieve the user, whose code is passed as URL parameter. Request's body is ignored.

```
GET /api/admin/users/{code}

<no request body>

{} : User
```

### addUsers

Adds new users to the database. Users' data is passed as request body except for the
`code` field, that is overwritten by software's procedure. Response body contains
the same user data, with codes and dates generated by server.

```
POST /api/admin/users

[] : User[]

[] : User[]
```

### updateUser

Update the user, whose code is passed as URL parameter, with new details passed
as request's body. However, only some details are updated. Refer to SSD.
Response's body contains updated user's data.

```
PUT /api/admin/users/{code}

{} : User

{} : User
```

### deleteUser

Deletes the user, whose code is passed as URL parameter. Request body is ignored.
In case of success, the server responds with `204 No Content` status,
since response's body is empty.

```
DELETE /api/admin/users/{code}

<no request body>

<no response body>
```

### getResources

Retrieves all resources matching the ()[EntitySetRequest]'s object given as request body.

```
GET /api/admin/resources

{} : EntitySetRequest

[] : Resource[]
```

### getResource

Retrieve the resource, whose code is passed as URL parameter. Request's body is ignored.

```
GET /api/admin/resources/{code}

<no request body>

{} : Resource
```

### addResources

Adds new resources to the database. Resources' data is passed as request body except for the
`code` field, that is overwritten by software's procedure. Response body contains
the same data, with codes and dates generated by server.

Resources' attributes and permissions are added separately. But, the software, considering
that the admin is who makes the request, adds automatically the full permission
for the admin user.

```
POST /api/admin/resources

[] : Resource[]

[] : Resource[]
```

### updateResource

Update the resource, whose code is passed as URL parameter, with new details passed
as request's body. However, only some details are updated. Refer to SSD.
Response's body contains updated resource's data.

Attributes and permissions are updated separately.

```
PUT /api/admin/resources/{code}

{} : Resource

{} : Resource
```

### deleteResource

Deletes the resource, whose code is passed as URL parameter. Request body is ignored.
In case of success, the server responds with `204 No Content` status,
since response's body is empty.

```
DELETE /api/admin/resources/{code}

<no request body>

<no response body>
```

### getResourceTypes

Retrieves all resource types matching the ()[EntitySetRequest]'s object given as request body.

```
GET /api/admin/types

{} : EntitySetRequest

[] : ResourceType[]
```

### getResourceType

Retrieve the resource type, whose code is passed as URL parameter. Request's body is ignored.

```
GET /api/admin/types/{code}

<no request body>

{} : ResourceType
```

### addResourceTypes

Adds new resource types to the database. Resource type's data is passed as request body except for the
`code` field, that is overwritten by software's procedure. Response body contains
the same data, with codes and dates generated by server.

```
POST /api/admin/types

[] : ResourceType[]

[] : ResourceType[]
```

### updateResourceType

Update the resource type, whose code is passed as URL parameter, with new details passed
as request's body. However, only some details are updated. Refer to SSD.
Response's body contains updated resource type's data.

Properties are updated separately.

```
PUT /api/admin/types/{code}

{} : ResourceType

{} : ResourceType
```

### deleteResourceType

Deletes the resource type, whose code is passed as URL parameter. Request body is ignored.
In case of success, the server responds with `204 No Content` status,
since response's body is empty.

```
DELETE /api/admin/types/{code}

<no request body>

<no response body>
```

### getResourceProperties

Retrieves all resource properties belonging to the resource type of given code,
passed as URL parameter. Request body is ignored

```
GET /api/admin/types/{code}/properties

<no request body>

[] : ResourceProperty[]
```

### getResourceProperty

Retrieve the resource property of given name, belonging to the resource type
of given code. Both identifiers are passed as URL parameters.

The `{name}` parameter is the property's pure name, without resource type code,
and without the pound sign (`#`). The system will automatically prepend them.

Request body is ignored.

```
GET /api/admin/types/{code}/properties/{name}

<no request body>

{} : ResourceProperty
```

### addResourceProperties

Adds resource property to the resource type of given code, passed as URL parameter.

The `name` field is to be intended as the pure name. The system will
automatically prepend the resource type's code and the pound sign (`#`).

Response body contains saved objects, with the full name set.

```
POST /api/admin/types/{code}/properties

[] : ResourceProperty[]

[] : ResourceProperty[]
```

### updateResourceProperty

Updates resource property of given name, belonging to resource type of given code.
Both are passed as URL parameters.

The `{name}` parameter is to be intended as the pure name. The system will
automatically prepend the resource type's code and the pound sign (`#`).

Response body contains updated object.

```
PUT /api/admin/types/{code}/properties/{name}

{} : ResourceProperty

{} : ResourceProperty
```

### deleteResourceProperty

Deletes the resource property of given name, belonging to the type of given code.
Both are passed as URL parameters.

The `{name}` parameter is to be intended as the pure name. The system will
automatically prepend the resource type's code and the pound sign (`#`).

Request body is ignored and response body is empty.

```
DELETE /api/admin/types/{code}/properties/{name}

<no request body>

<no response body>
```

### getResourceAttributes

Retrieves all resource attributes belonging to the resource of given code,
passed as URL parameter. Request body is ignored.

```
GET /api/admin/resources/{code}/attributes

<no request body>

[] : Resource[]
```

### getResourceAttribute

Retrieve the resource attribute of given name, belonging to the resource
of given code. Both identifiers are passed as URL parameters.

The `{name}` parameter is the attribute's pure name, without resource's code,
and without the pound sign (`#`). The system will automatically prepend them.

Request body is ignored.

```
GET /api/admin/resources/{code}/attributes/{name}

<no request body>

{} : ResourceAttribute
```

### addResourceAttributes

Adds resource attributes to the resource of given code, passed as URL parameter.

The `name` field is to be intended as the pure name. The system will
automatically prepend the resource's code and the pound sign (`#`).

Response body contains saved objects, with the full name set.

```
POST /api/admin/resources/{code}/attributes

[] : ResourceAttribute[]

[] : ResourceAttribute[]
```

### updateResourceAttribute

Updates resource attribute of given name, belonging to the resource of given code.
Both are passed as URL parameters.

The `{name}` parameter is to be intended as the pure name. The system will
automatically prepend the resource's code and the pound sign (`#`).

Response body contains updated object.

```
PUT /api/admin/resources/{code}/attributes/{name}

{} : ResourceAttribute

{} : ResourceAttribute
```

### deleteResourceAttribute

Deletes the resource attribute of given name, belonging to the resource of given code.
Both are passed as URL parameters.

The `{name}` parameter is to be intended as the pure name. The system will
automatically prepend the resource's code and the pound sign (`#`).

Request body is ignored and response body is empty.

```
DELETE /api/admin/resources/{code}/attributes/{name}

<no request body>

<no response body>
```

### setResourcePermissions

Sets permissions on the resource of given code, passed as URL parameter.
Remember that is not possible to delete the `FULL` permission, since it's
needed to identify the resource's author.

Response body contains saved objects.

```
GET /api/admin/resources/{code}/permissions

[] : ResourcePermission[]

[] : ResourcePermission[]
```

## User endpoints

### resetPassword

Issues password reset for current user. Request body is ignored and response body is empty.

```
GET /api/user/password-reset

<no request body>

<no response body>
```

### getUsers

Retrieves all users matching the ()[EntitySetRequest]'s object given as request body.

```
GET /api/user/users

{} : EntitySetRequest

[] : User[]
```

### getUser

Retrieve the user, whose code is passed as URL parameter. Request's body is ignored.

```
GET /api/user/users/{code}

<no request body>

{} : User
```

### getResources

Retrieves all resources matching the ()[EntitySetRequest]'s object given as request body.

Only resources, on which current user has, at least, read permissions, are fetched.

```
GET /api/user/resources

{} : EntitySetRequest

[] : Resource[]
```

### getResource

Retrieve the resource, whose code is passed as URL parameter. Request's body is ignored.

Only user with, at least `READ` permission on requested resource,
are authorized to access this method.

```
GET /api/user/resources/{code}

<no request body>

{} : Resource
```

### addResources

Adds new resources to the database. Resources' data is passed as request body except for the
`code` field, that is overwritten by software's procedure. Response body contains
the same data, with codes and dates generated by server.

Resources' attributes and permissions are added separately. But, the software, considering
that the admin is who makes the request, adds automatically the full permission
for the admin user.

Only users with role `EDITOR` are authorized to access this method.

```
POST /api/user/resources

[] : Resource[]

[] : Resource[]
```

### updateResource

Update the resource, whose code is passed as URL parameter, with new details passed
as request's body. However, only some details are updated. Refer to SSD.
Response's body contains updated resource's data.

Attributes and permissions are updated separately.

Only users that meet these conditions are authorized to access this method:
* user is of role `EDITOR`
* user has got `WRITE` or `FULL` permission to the resource

```
PUT /api/user/resources/{code}

{} : Resource

{} : Resource
```

### deleteResource

Deletes the resource, whose code is passed as URL parameter. Request body is ignored.
In case of success, the server responds with `204 No Content` status,
since response's body is empty.

This method is accessible only if user has `FULL` permission on the resource.

```
DELETE /api/user/resources/{code}

<no request body>

<no response body>
```

### getResourceAttributes

Retrieves all resource attributes belonging to the resource of given code,
passed as URL parameter. Request body is ignored.

```
GET /api/admin/resources/{code}/attributes

<no request body>

[] : Resource[]
```

### getResourceAttribute

Retrieve the resource attribute of given name, belonging to the resource
of given code. Both identifiers are passed as URL parameters.

The `{name}` parameter is the attribute's pure name, without resource's code,
and without the pound sign (`#`). The system will automatically prepend them.

Only users with, at least, `READ` permission on requested resource
are authorized to access this method.

Request body is ignored.

```
GET /api/user/resources/{code}/attributes/{name}

<no request body>

{} : ResourceAttribute
```

### addResourceAttributes

Adds resource attributes to the resource of given code, passed as URL parameter.

The `name` field is to be intended as the pure name. The system will
automatically prepend the resource's code and the pound sign (`#`).

Only users with, at least, `WRITE` permission on requested resource
are authorized to access this method.

Response body contains saved objects, with the full name set.

```
POST /api/user/resources/{code}/attributes

[] : ResourceAttribute[]

[] : ResourceAttribute[]
```

### updateResourceAttribute

Updates resource attribute of given name, belonging to the resource of given code.
Both are passed as URL parameters.

The `{name}` parameter is to be intended as the pure name. The system will
automatically prepend the resource's code and the pound sign (`#`).

Only users with, at least, `WRITE` permission on requested resource
are authorized to access this method.

Response body contains updated object.

```
PUT /api/user/resources/{code}/attributes/{name}

{} : ResourceAttribute

{} : ResourceAttribute
```

### deleteResourceAttribute

Deletes the resource attribute of given name, belonging to the resource of given code.
Both are passed as URL parameters.

The `{name}` parameter is to be intended as the pure name. The system will
automatically prepend the resource's code and the pound sign (`#`).

Only users with, at least, `WRITE` permission on requested resource
are authorized to access this method.

Request body is ignored and response body is empty.

```
DELETE /api/user/resources/{code}/attributes/{name}

<no request body>

<no response body>
```

### setResourcePermissions

Sets permissions on the resource of given code, passed as URL parameter.

Only users with `FULL` permission on requested resource are authorized
to access this method, and this permission can't be deleted.

Response body contains saved objects.

```
GET /api/user/resources/{code}/permissions

[] : ResourcePermission[]

[] : ResourcePermission[]
```